mxn.register("leaflet",{Mapstraction:{init:function(e,t){if("undefined"!=typeof L){var a=this,r=new L.Map(e.id,{zoomControl:!1});r.addEventListener("moveend",function(e){if(r){var t=r.getZoom(),o=r.getCenter();console.log("zoom = ",t),console.log("lat = ",o.lat),console.log("lng = ",o.lng),asf1plus.util_b.setCookie("zoom",t),asf1plus.util_b.setCookie("centerLat",o.lat),asf1plus.util_b.setCookie("centerLng",o.lng)}a.endPan.fire()}),r.on("click",function(e){a.click.fire({location:new mxn.LatLonPoint(e.latlng.lat,e.latlng.lng)})}),r.on("popupopen",function(e){e.popup._source.mxnMarker&&e.popup._source.mxnMarker.openInfoBubble.fire({bubbleContainer:e.popup._container})}),r.on("popupclose",function(e){e.popup._source.mxnMarker&&e.popup._source.mxnMarker.closeInfoBubble.fire({bubbleContainer:e.popup._container})}),r.once("focus",function(){r.scrollWheelZoom.enable()}),this.layers={},this.features=[],this.maps[t]=r,this.loaded[t]=!0}else alert(t+" map script not imported")},applyOptions:function(){this.options.enableScrollWheelZoom?this.maps[this.api].scrollWheelZoom.enable():this.maps[this.api].scrollWheelZoom.disable(),this.options.enableDragging?this.maps[this.api].dragging.enable():this.maps[this.api].dragging.disable()},resizeTo:function(e,t){this.currentElement.style.width=e,this.currentElement.style.height=t,this.maps[this.api].invalidateSize()},setInvalidateSize:function(){var e=this.maps[this.api];e.invalidateSize()},addControls:function(e,t,a){var r=this.maps[this.api];switch(e.toLowerCase()){case"scale":if(t.isAdd){var o=new L.control.scale(t.options);r.addControl(o)}break;case"distance":t.isAdd&&this.addDistance();break;case"search":a&&this.addSearch(a);break;default:window.developer&&console.log(e+" is not defined")}},addDistance:function(){window.developer&&console.log(1);var e=this.maps[this.api],t=12.55,a=17.89,r=["<table>",' <tr><td class="cost_label">Cost Above Ground:</td><td class="cost_value">${total_above_ground}</td></tr>',' <tr><td class="cost_label">Cost Underground:</td><td class="cost_value">${total_underground}</td></tr>',"</table>"].join(""),o=function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},i=L.Control.LinearCore.extend({onSelect:function(e){if(e.total){var i=e.total.scalar;"mi"===e.total.unit?i*=e.sub_unit:"km"===e.total.unit?i*=3280.84:"m"===e.total.unit&&(i*=3.28084);var n={total_above_ground:o(L.Util.formatNum(a*i,2)),total_underground:o(L.Util.formatNum(t*i,2))};if(e.rulerOn){var s=L.Util.template(r,n),l=L.popup().setContent(s);e.total_label.bindPopup(l,{offset:[45,0]}),e.total_label.openPopup()}}}});e.addControl(new i({position:"bottomleft",unitSystem:"metric",color:"#FF0080",features:["ruler","trash"]}))},addSearch:function(e){var t=this.maps[this.api],a=e.search;if(void 0!==a.url&&""!==a.url){function r(e,t){return $.ajax({url:a.url,xhrFields:{withCredentials:!0},type:a.type||"GET",data:{q:e},dataType:"json",success:function(e){t(e)}})}var o=new L.Control.Search({sourceData:r,markerLocation:!0,container:"thsIdSearchBody",position:"topright",url:a.url||"",zoom:a.zoom||16,minLength:a.minLength||1,initial:!1,casesensitive:a.casesensitive||!1,propertyLoc:a.propertyLoc||"loc",propertyName:a.propertyName||"title",collapsed:!1,textErr:dictionary.map_search_textErr[dictionary.lang],textCancel:dictionary.map_search_textCancel[dictionary.lang],textPlaceholder:dictionary.map_search_textPlaceholder[dictionary.lang],marker:a.marker||{icon:!1,animate:!0,circle:{radius:10,weight:3,color:"blue",stroke:!0,fill:!1}}})}else if("choropleth"==e.type||"choroplethPattern"==e.type){var i=asf1plus.util.getObjWithMas(window.global_overLayersObj,"id",e.id),n=i[0].data;t.addLayer(n);o=new L.Control.Search({container:"thsIdSearchBody",layer:n,propertyName:e.addSearch.attributes,url:a.url||"",zoom:a.zoom||16,minLength:a.minLength||1,initial:!1,casesensitive:a.casesensitive||!1,collapsed:!1,autoCollapse:!0,autoCollapseTime:a.autoCollapseTime||1200,hideMarkerOnCollapse:!0,textErr:dictionary.map_search_textErr[dictionary.lang],textCancel:dictionary.map_search_textCancel[dictionary.lang],textPlaceholder:dictionary.map_search_textPlaceholder[dictionary.lang],marker:!1,moveToLocation:function(e,t,a){var r=a.getBoundsZoom(e.layer.getBounds());a.setView(e,r)}});o.on("search:locationfound",function(e){var t=$(".active-layers option:selected").val(),a=asf1plus.util.getObjWithMas(window.overLayers,"id",t);a=a[0];var r=a.search.color,o=a.search.fillColor;e.layer.setStyle({fillColor:o,color:r})}).on("search:collapsed",function(e){n.eachLayer(function(e){n.resetStyle(e)})})}else if("pointIco"==e.type||"pointText"==e.type||"chart_pie"==e.type||"chart_bar"==e.type||"chart_radialBar"==e.type||"chart_coxcomb"==e.type){e.addMySearch;for(var s=e.id,l=asf1plus.util.getObjWithMas(overLayers,"id",s),p=l[0].data,c=asf1plus.util.getObjWithMas(data,"id",p),u=l[0].geom,d=asf1plus.util.getObjWithMas(geom,"id",u),h=asf1plus.util.makeGeoJSON(d[0].nameIdProp,window[d[0].data],window[c[0].data].id,window[c[0].data].data),m=[],f=0;f<h.features.length;f++){var y=h.features[f],g=[y.geometry.coordinates[1],y.geometry.coordinates[0]],v=y.properties[e.addSearch.attributes];m.push({loc:g,title:v})}var w=new L.featureGroup;t.addLayer(w);o=new L.Control.Search({container:"thsIdSearchBody",position:"topright",layer:w,url:a.url||"",zoom:a.zoom||16,minLength:a.minLength||1,initial:!1,casesensitive:a.casesensitive||!1,propertyLoc:a.propertyLoc||"loc",propertyName:a.propertyName||"title",collapsed:!1,textErr:dictionary.map_search_textErr[dictionary.lang],textCancel:dictionary.map_search_textCancel[dictionary.lang],textPlaceholder:dictionary.map_search_textPlaceholder[dictionary.lang],marker:a.marker||{icon:!1,animate:!0,circle:{radius:10,weight:3,color:"blue",stroke:!0,fill:!1}}});for(f in m){v=m[f].title,g=m[f].loc;var b=new L.Marker(new L.latLng(g),{title:v});w.addLayer(b)}}t.addControl(o);window.mapGlobal=t,window.searchMas=o},addSmallControls:function(){throw"Not implemented"},addLargeControls:function(){throw"Not implemented"},addMapTypeControls:function(){throw"Not implemented"},setCenterAndZoom:function(e,t,a){var r=this.maps[this.api],o=e.toProprietary(this.api);r.setView(o,t)},addMarker:function(e,t,a,r){for(var o=this.maps[this.api],i=(e.toProprietary(this.api),[]),n=[],s=function(e,t){for(var a=0;a<t.length;a++){var r=t[a].beginValue,o=t[a].endValue;if(r!=1/0&&o!=1/0){if(e>=+r&&e<=+o)return t[a]}else if(r==1/0&&o!=1/0){if(e<=+o)return t[a]}else if(r!=1/0&&o==1/0){if(e>=+r)return t[a]}else if(r==1/0&&o==1/0)return t[a]}},l=0;l<a.features.length;l++){var p,c=a.features[l],u=c.geometry.coordinates,d=c.properties;n.push(d);if(null!=r.marker)p=r.marker.options;else if(void 0!==r.value&&void 0!==r.range)if(r.value.length>0&&r.range.length>0){var h=s(c.properties[r.value[0]],r.range);p=h.marker.options}else console.log("Layer configuration error");else console.log("Layer configuration error");var m=p.icoUrl,f=p.shadowUrl,y=p.iconSize,g=p.shadowSize,v=p.iconAnchor,w=p.shadowAnchor,b=p.popupAnchor,_='<table class="table">';for(var k in r.popup)d[k]&&(_+="<tr>",_+="<td><strong>"+r.popup[k][dictionary.lang]+"</strong></td>",_+="<td>"+d[k]+"</td>",_+="</tr>");_+="</table>",i.push(L.marker([u[1],u[0]],{icon:L.icon({iconUrl:m,shadowUrl:f,iconSize:y,shadowSize:g,iconAnchor:v,shadowAnchor:w,popupAnchor:b})}).bindPopup(_))}var x=L.layerGroup(i,{attribution:r.attribution,makeBoundsAware:!0,minZoom:r.minZoom||1,maxZoom:r.maxZoom||18});return o.addLayer(x),asf1plus.util.autoGenGlobalMas("global_overLayersObj",r.id,"id",x),pointLayerMas[r.id]=x,this.features.push(x),x},addMarkerText:function(e,t,a,r){for(var o=this.maps[this.api],i=(e.toProprietary(this.api),[]),n=[],s=0;s<a.features.length;s++){var l=a.features[s],p=l.geometry.coordinates,c=l.properties;n.push(c);var u=r.marker.options,d=u.icoUrl,h=u.shadowUrl,m=u.iconSize,f=u.shadowSize,y=u.iconAnchor,g=u.shadowAnchor,v=u.popupAnchor,w=u.className,b=u.html,_=u.val,k=u.bgPos,x=u.style,P=_?"<div style='"+x+"'>"+b+c[_]+"</div>":"",C='<table class="table">';for(var S in r.popup)c[S]&&(C+="<tr>",C+="<td><strong>"+r.popup[S][dictionary.lang]+"</strong></td>",C+="<td>"+c[S]+"</td>",C+="</tr>");C+="</table>",i.push(L.marker([p[1],p[0]],{icon:L.divIcon({className:w,html:P,bgPos:k,iconUrl:d,shadowUrl:h,iconSize:m,shadowSize:f,iconAnchor:y,shadowAnchor:g,popupAnchor:v})}).bindPopup(C))}var M=L.layerGroup(i,{attribution:r.attribution,makeBoundsAware:!0,minZoom:r.minZoom||1,maxZoom:r.maxZoom||18});return asf1plus.util.autoGenGlobalMas("global_overLayersObj",r.id,"id",M),o.addLayer(M),pointLayerMas[r.id]=M,this.features.push(M),M},addLinearMeasurement:function(){},removeMarker:function(e){var t=this.maps[this.api];t.removeLayer(e)},declutterMarkers:function(e){throw"Not implemented"},addPolyline:function(e,t,a,r){window.developer&&console.log(1);var o=this.maps[this.api];e=e.toProprietary(this.api,a,r),o.addLayer(e);var i=e.options.name;return i?this.features[i]=e:this.features.push(e),e},addCharts:function(e,t,a,r){for(var o=this.maps[this.api],i=[],n=0;n<a.features.length;n++){var s=a.features[n].properties||!1,l=(a.features[n].geometry.coordinates,{}),p={};if(s){var c=r.type||null,u=(r.chart.labels,r.chart.colors,r.chart.options||null);u.data={},u.chartOptions={};p=r.chart.chartOptions||null;for(var d=0;d<p.length;d++){var h=p[d],m=h.value||!1,f=h.label||m;h.color;m&&f&&(u.data[f]=s[m]||null,u.chartOptions[f]=h,u.radius=s[u.radiusProp]||u.radius||10)}var y=!1;if(c&&l&&u)switch(c){case"chart_pie":y=new L.PieChartMarker(new L.LatLng(s.y,s.x),u);break;case"chart_bar":y=new L.BarChartMarker(new L.LatLng(s.y,s.x),u);break;case"chart_radialBar":y=new L.RadialBarChartMarker(new L.LatLng(s.y,s.x),u);break;case"chart_coxcomb":y=new L.CoxcombChartMarker(new L.LatLng(s.y,s.x),u);break;default:window.developer&&console.log(c+" not found")}y?(asf1plus.util.autoGenGlobalMas("global_overLayersObj",r.id,"id",y),i.push(y)):window.developer&&console.log("layer not found")}}if(i.length>0){e=L.layerGroup(i,{attribution:r.attribution,makeBoundsAware:!0,minZoom:r.minZoom||1,maxZoom:r.maxZoom||18}),o.addLayer(e);var g=e.options.name;return g?this.features[g]=e:this.features.push(e),e}return 0},addWMS:function(e,t,a,r){var o=this.maps[this.api],i=r.wms,n=new L.tileLayer.wms(i.url,{layers:i.layers||!1,format:i.format||!1,transparent:i.transparent||!1,attribution:i.attribution||!1,zIndex:9999});return o.addLayer(n),this.features.push(n),n},removePolyline:function(e){window.developer&&console.log(1);var t=this.maps[this.api];t.removeLayer(e.proprietary_polyline)},removeCharts:function(e){window.developer&&console.log(e);var t=this.maps[this.api];t.removeLayer(e.proprietary_polyline)},removeWMS:function(e){window.developer&&console.log(e);var t=this.maps[this.api];t.removeLayer(e.proprietary_polyline)},getCenter:function(){var e=this.maps[this.api],t=e.getCenter();return new mxn.LatLonPoint(t.lat,t.lng)},setCenter:function(e,t){var a=this.maps[this.api],r=e.toProprietary(this.api);t&&t.pan?a.panTo(r):a.setView(r,a.getZoom(),!0)},setZoom:function(e){var t=this.maps[this.api];e||(e=t._layersMaxZoom),t.setZoom(e)},getZoom:function(){var e=this.maps[this.api];return e.getZoom()},getZoomLevelForBoundingBox:function(e){var t=this.maps[this.api],a=new L.LatLngBounds(e.getSouthWest().toProprietary(this.api),e.getNorthEast().toProprietary(this.api));return t.getBoundsZoom(a)},setMapType:function(e){if(e){this.removeTileLayer();var t=asf1plus.util.getObjWithMas(baseLayers,"id",e);t=t[0],this.addTileLayer({urlTiles:t.urlTiles,name:t.name,attribution:t.attribution[dictionary.lang]||"",minZoom:t.minZoom||0,maxZoom:t.maxZoom||18,errorTileUrl:t.errorTileUrl||"",zoomOffset:t.zoomOffset||0,tms:t.tms||!1,zoomReverse:t.zoomReverse||!1,detectRetina:t.detectRetina||!1,crossOrigin:t.crossOrigin||!1,opacity:t.opacity||1,type:t.type||!1,proxy:t.proxy||!1}),this.currentMapType=t.name}},getMapType:function(){return this.currentMapType},getBounds:function(){var e=this.maps[this.api],t=e.getBounds(),a=t.getSouthWest(),r=t.getNorthEast();return new mxn.BoundingBox(a.lat,a.lng,r.lat,r.lng)},setBounds:function(e){var t=this.maps[this.api],a=e.getSouthWest().toProprietary(this.api),r=e.getNorthEast().toProprietary(this.api),o=new L.LatLngBounds(a,r);t.fitBounds(o)},addImageOverlay:function(e,t,a,r,o,i,n){throw"Not implemented"},setImagePosition:function(e,t){throw"Not implemented"},addOverlay:function(e,t){throw"Not implemented"},addTileLayer:function(e){var t;switch(e&&e.name?(t=e.name,delete e.name):t="Tiles",e.type){case"google":"ROADMAP"!=e.urlTiles.toUpperCase()&&"SATELLITE"!=e.urlTiles.toUpperCase()&&"HYBRID"!=e.urlTiles.toUpperCase()&&"TERRAIN"!=e.urlTiles.toUpperCase()||(this.layers[t]=L.gridLayer.googleMutant({type:e.urlTiles.toLowerCase(),minZoom:e.minZoom||1,maxZoom:e.maxZoom||18}));break;case"esri_basemapLayer":this.layers[t]=L.esri.basemapLayer(e.urlTiles);break;case"esri_vectorBasemap":this.layers[t]=L.esri.Vector.basemap(e.urlTiles);break;case"esri_tiledMapLayer":this.layers[t]=L.esri.tiledMapLayer({url:e.urlTiles,proxy:e.proxy});break;default:this.layers[t]=new L.TileLayer(e.urlTiles,e||{})}var a=this.maps[this.api];asf1plus.util.autoGenGlobalMas("global_overLayersObj",e.type,"id",this.layers[t]),a.addLayer(this.layers[t])},removeTileLayer:function(e,t){var a=this.maps[this.api];if(window.developer&&console.log(this.layers),window.developer&&console.log(a._layers),!$.isEmptyObject(a._layers)){var r=a._layers,o=this.layers;for(var i in r){var n=r[i],s=n._url;for(var l in o){var p=o[l],c=p._url;s==c&&a.removeLayer(p)}}}},toggleTileLayer:function(e){throw"Not implemented"},getPixelRatio:function(){throw"Not implemented"},mousePosition:function(e){throw"Not implemented"},openBubble:function(e,t){var a=this.maps[this.api],r=e.toProprietary(this.api),o=new L.Marker(r);o.bindPopup(t),a.addLayer(o),o.openPopup()},closeBubble:function(){var e=this.maps[this.api];e.closePopup()}},LatLonPoint:{toProprietary:function(){return new L.LatLng(this.lat,this.lon)},fromProprietary:function(e){this.lat=e.lat(),this.lon=e.lng()}},Marker:{toProprietary:function(){var e=this,t=L.Icon;e.iconUrl&&(t=t.extend({iconUrl:e.iconUrl})),e.iconSize&&(t=t.extend({iconSize:new L.Point(e.iconSize[0],e.iconSize[1])})),e.iconAnchor&&(t=t.extend({iconAnchor:new L.Point(e.iconAnchor[0],e.iconAnchor[1])})),e.iconShadowUrl&&(t=t.extend({shadowUrl:e.iconShadowUrl})),e.iconShadowSize&&(t=t.extend({shadowSize:new L.Point(e.iconShadowSize[0],e.iconShadowSize[1])}));new t;var a=new L.Marker(this.location.toProprietary("leaflet"));return function(e,t){t.on("click",function(t){e.click.fire()})}(e,a),a},openBubble:function(){var e=this.proprietary_marker;this.infoBubble&&(e.mxnMarker=this,e.bindPopup(this.infoBubble),e.openPopup())},closeBubble:function(){var e=this.proprietary_marker;e.closePopup()},hide:function(){var e=this.mapstraction.maps[this.api];e.removeLayer(this.proprietary_marker)},show:function(){var e=this.mapstraction.maps[this.api];e.addLayer(this.proprietary_marker)},isHidden:function(){var e=this.mapstraction.maps[this.api];return!e.hasLayer(this.proprietary_marker)},update:function(){throw"Not implemented"}},Polyline:{toProprietary:function(e,t,a){if("choroplethPattern"==a.type){function r(e,t){for(var r=e[a.value[0]],o=a.range,i=function(e,t){var a=e.shape,r=new L.PatternPath({d:a.d,color:a.fillColor}),o=new L.Pattern({width:a.widthCanvas,height:a.heightCanvas,angle:a.angleCanvas});return o.addShape(r),o.addTo(t.maps.leaflet),{fillPattern:o,color:a.color,weight:a.width,opacity:a.opacity,fillOpacity:a.fillOpacity,dashArray:a.dashArray,fill:a.fill}},n=0;n<o.length;n++){var s=o[n].beginValue,l=o[n].endValue;if(s!=1/0&&l!=1/0){if(r>=+s&&r<=+l)return i(o[n],t)}else if(s==1/0&&l!=1/0){if(r<=+l)return i(o[n],t)}else if(s!=1/0&&l==1/0){if(r>=+s)return i(o[n],t)}else if(s==1/0&&l==1/0)return i(o[n],t)}}console.log(1);this.map;var o=L.geoJson(t,{style:function(e,t){return r(e.properties,asf1plus.map.getObjThsMap("mydiva2"))},onEachFeature:function(e,t){e.properties?t.bindPopup(function(){var t=a.popup,r='<div class="view">';for(key in t)e.properties[key]&&(r+='<div class="ViewPropName"><b>'+t[key][dictionary.lang]+':</b></div><div class="ViewPropValue">'+e.properties[key]+"</div>");return r+="</div>",r},{minWidth:200,minHeight:100,maxHeight:300,maxWidth:300}):window.developer&&console.log(e.properties.Name_2)}});return asf1plus.util.autoGenGlobalMas("global_overLayersObj",a.id,"id",o),o}{function r(e){for(var t=e[a.value[0]],r=a.range,o=0;o<r.length;o++){var i=r[o].beginValue,n=r[o].endValue;if(i!=1/0&&n!=1/0){if(t>=+i&&t<=+n)return r[o]}else if(i==1/0&&n!=1/0){if(t<=+n)return r[o]}else if(i!=1/0&&n==1/0){if(t>=+i)return r[o]}else if(i==1/0&&n==1/0)return r[o]}}console.log(1);var i={style:function(e){return r(e.properties)},onEachFeature:function(e,t){e.properties?t.bindPopup(function(){var t=a.popup,r='<div class="view">';for(key in t)e.properties[key]&&(r+='<div class="ViewPropName"><b>'+t[key][dictionary.lang]+':</b></div><div class="ViewPropValue">'+e.properties[key]+"</div>");return r+="</div>",r},{minWidth:200,minHeight:100,maxHeight:300,maxWidth:300}):console.log(e.properties.Name_2)}},n=new L.geoJSON(t,i);return asf1plus.util.autoGenGlobalMas("global_overLayersObj",a.id,"id",n),n}},show:function(){this.map.addLayer(this.proprietary_polyline)},hide:function(){this.map.removeLayer(this.proprietary_polyline)},isHidden:function(){return!this.map.hasLayer(this.proprietary_polyline)}},Charts:{toProprietary:function(e,t,a){window.developer&&console.log("__mxn.leaflet.core__charts.toProprietary",e,t,a)},show:function(){this.map.addLayer(this.proprietary_Charts)},hide:function(){this.map.removeLayer(this.proprietary_Charts)},isHidden:function(){return!this.map.hasLayer(this.proprietary_Charts)}},WMS:{toProprietary:function(e){var t=new L.tileLayer.wms(e.url,{layers:e.layers||!1,format:e.format||!1,transparent:e.transparent||!1,attribution:e.attribution||!1});return t}}});